/*******************************************************************
 *       Filename:  f2b.c                                     
 *                                                                 
 *    Description:                                        
 *                                                                 
 *        Version:  1.0                                            
 *        Created:  2016年08月05日 10时34分30秒                                 
 *       Revision:  none                                           
 *       Compiler:  gcc                                           
 *                                                                 
 *         Author:  Ruan Huabin                                      
 *          Email:  ruanhuabin@gmail.com                                        
 *        Company:  HPC tsinghua                                      
 *                                                                 
 *******************************************************************/


#include <stdio.h>
#include <stdlib.h>
#include <string.h>

const char *bitValue[256] = 
 {
    "00000000", "00000001", "00000010", "00000011", "00000100", "00000101", "00000110", "00000111",
    "00001000", "00001001", "00001010", "00001011", "00001100", "00001101", "00001110", "00001111",
    "00010000", "00010001", "00010010", "00010011", "00010100", "00010101", "00010110", "00010111",
    "00011000", "00011001", "00011010", "00011011", "00011100", "00011101", "00011110", "00011111",
    "00100000", "00100001", "00100010", "00100011", "00100100", "00100101", "00100110", "00100111",
    "00101000", "00101001", "00101010", "00101011", "00101100", "00101101", "00101110", "00101111",
    "00110000", "00110001", "00110010", "00110011", "00110100", "00110101", "00110110", "00110111",
    "00111000", "00111001", "00111010", "00111011", "00111100", "00111101", "00111110", "00111111",
    "01000000", "01000001", "01000010", "01000011", "01000100", "01000101", "01000110", "01000111",
    "01001000", "01001001", "01001010", "01001011", "01001100", "01001101", "01001110", "01001111",
    "01010000", "01010001", "01010010", "01010011", "01010100", "01010101", "01010110", "01010111",
    "01011000", "01011001", "01011010", "01011011", "01011100", "01011101", "01011110", "01011111",
    "01100000", "01100001", "01100010", "01100011", "01100100", "01100101", "01100110", "01100111",
    "01101000", "01101001", "01101010", "01101011", "01101100", "01101101", "01101110", "01101111",
    "01110000", "01110001", "01110010", "01110011", "01110100", "01110101", "01110110", "01110111",
    "01111000", "01111001", "01111010", "01111011", "01111100", "01111101", "01111110", "01111111",
    "10000000", "10000001", "10000010", "10000011", "10000100", "10000101", "10000110", "10000111",
    "10001000", "10001001", "10001010", "10001011", "10001100", "10001101", "10001110", "10001111",
    "10010000", "10010001", "10010010", "10010011", "10010100", "10010101", "10010110", "10010111",
    "10011000", "10011001", "10011010", "10011011", "10011100", "10011101", "10011110", "10011111",
    "10100000", "10100001", "10100010", "10100011", "10100100", "10100101", "10100110", "10100111",
    "10101000", "10101001", "10101010", "10101011", "10101100", "10101101", "10101110", "10101111",
    "10110000", "10110001", "10110010", "10110011", "10110100", "10110101", "10110110", "10110111",
    "10111000", "10111001", "10111010", "10111011", "10111100", "10111101", "10111110", "10111111",
    "11000000", "11000001", "11000010", "11000011", "11000100", "11000101", "11000110", "11000111",
    "11001000", "11001001", "11001010", "11001011", "11001100", "11001101", "11001110", "11001111",
    "11010000", "11010001", "11010010", "11010011", "11010100", "11010101", "11010110", "11010111",
    "11011000", "11011001", "11011010", "11011011", "11011100", "11011101", "11011110", "11011111",
    "11100000", "11100001", "11100010", "11100011", "11100100", "11100101", "11100110", "11100111",
    "11101000", "11101001", "11101010", "11101011", "11101100", "11101101", "11101110", "11101111",
    "11110000", "11110001", "11110010", "11110011", "11110100", "11110101", "11110110", "11110111",
    "11111000", "11111001", "11111010", "11111011", "11111100", "11111101", "11111110", "11111111"
 };


/**
 *  Convert float number to its binary reprentation
 */
void f2b(float *num, int n, char **bitRepr)
{
    char *byte = NULL;
    int index = 0;
    for(int i = 0; i < n; i ++)
    {
        byte = (char *)&num[i];
        for(int j = 3; j >= 0; j --)
        {
            index = (int)(byte[j]&0xff);
            /*printf("index = %d: %x\n", index, byte[j] & 0xff);*/
            strcat(bitRepr[i], bitValue[index]);
            strcat(bitRepr[i], " ");
        }
    
    }
}

int main ( int argc, char *argv[] )
{ 
    if(argc < 2)
    {
        printf("Usage: %s <float number1> [float number2] [float number3] ... [float numberN]\n", argv[0]);
        printf("E.G: %s 2.34 4.56\n", argv[0]);
        exit(-1);
    }

    float *number = (float *)malloc((argc - 1) * sizeof(float));
    for(int i = 1; i < argc; i ++)
    {
        number[i - 1] = atof(argv[i]);
    }

    char **bitRepr = (char **) malloc((argc - 1) * sizeof(char *));

    

    for(int i = 0; i < argc - 1; i ++)
    {
        bitRepr[i] = (char *)malloc( 37 * sizeof(char));
        memset(bitRepr[i], '\0', 37 * sizeof(char));
    }

    
    f2b(number, argc - 1, bitRepr);
    for(int i = 0; i < argc - 1; i ++)
    {
        printf("%f:%s\n", number[i], bitRepr[i]);
    }

    printf("\n");

    char **xorResult = (char **) malloc((argc - 1) * sizeof(char *));
    for(int i = 0; i < argc - 1; i ++)
    {
        xorResult[i] = (char *)malloc( 37 * sizeof(char));
        memset(xorResult[i], '\0', 37 * sizeof(char));
    }

    int numCnt = argc - 1;
    int j = 0;
    for(int i = 0; i < numCnt - 1; i ++ )
    {
        j = i + 1;
        for(int k = 0; k < 37; k ++)
        {
            if(bitRepr[i][k] ==  bitRepr[j][k])
            {
                if(bitRepr[i][k] == ' ' || bitRepr[i][k] == '\0')
                {
                    xorResult[i][k] = ' ';
                }
                else
                {
                    xorResult[i][k] = '0';
                }
            }
            else
            {
                xorResult[i][k] = '1';
            }
        }
        
    }

    printf("XOR result between neigbours\n");
    for(int i = 0; i < numCnt - 1; i ++)
    {
        j = i + 1;
        printf("[ %f xor %f ]:%s\n", number[i], number[j], xorResult[i]);
    }

    printf("\n");

    for(int i = 0; i < argc - 1; i ++)
    {
        free(bitRepr[i]);
        free(xorResult[i]);
    }

    free(bitRepr);
    free(xorResult);

    free(number);

    return 0;
    float num = 2.34;
    char *byte = &num;

    for(int i = 3; i >= 0; i--)
    {
        printf("%x", byte[i] & 0xff);
    }
    printf("\n");
    return EXIT_SUCCESS;
}

